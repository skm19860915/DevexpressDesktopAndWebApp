(function(c){var b=EzRez.Util.Event.pubsub;var d=function(f){var e=Object.extend({hotelDisplay:"",query:"",url:""},f);this.hotelDisplay=e.hotelDisplay;this.query=e.query;this.url=e.url;};var a=function(j){var l=Object.extend({inputElement:null,resultsElement:null,filterNameElement:null,url:"/service/autocomplete/",FORCE_SELECTION:true,USE_SHADOW:true,ANIM_HORIZ:true,ANIM_SPEED:0.3,MAX_RESULTS_DISPLAYED:15,QUERY_DELAY:0},j);var p;var n;var g;function m(){p=f(l.inputElement);n=f(l.resultsElement);g=f(l.filterNameElement).getValue();i();}function f(q){q=$(q);if(!Object.isElement(q)){q=$$(q).first();}return q;}function h(t,r){p.value="";var q=new d(r[2]);var s=c.use("searchFilterSettingsComponent");if(s){s.saveHotelSearchFilterSettings();}location.href=q.url;}function k(q){p.value="";}function o(r,s){var q=new d(r);return q.hotelDisplay;}function e(q){b.publish("HotelAutoComplete/requestGenerated");return"?"+Object.toQueryString({query:q,filter:g});}function i(){var r=new YAHOO.util.XHRDataSource(l.url);r.responseType=YAHOO.util.XHRDataSource.TYPE_JSON;r.maxCacheEntries=50;r.responseSchema={resultsList:"autoCompleteResults",fields:["hotelDisplay","query","url"]};var q=new YAHOO.widget.AutoComplete(p,n,r);q.queryDelay=l.QUERY_DELAY;q.maxResultsDisplayed=l.MAX_RESULTS_DISPLAYED;q.forceSelection=l.FORCE_SELECTION;q.useShadow=l.USE_SHADOW;q.animHoriz=l.ANIM_HORIZ;q.animSpeed=l.ANIM_SPEED;q.resultTypeList=false;q.formatResult=o;q.generateRequest=e;q.textboxFocusEvent.subscribe(k);q.itemSelectEvent.subscribe(h);}this.init=m;};c.createUIComponent("hotelAutoComplete",{initialize:function(e){return new a(e);}});})(EzRez.Application);(function(b){var a=EzRez.Util.Event.pubsub;b.createUIComponent("alignHotelFilters",(function(){var g="show_hide_modify";var e="hotel_avail_container";var f="hotel_filters";var d=function(){};var c=function(h){if(d){d();}if(!$(e)){return;}if(!$(f)){return;}var l=$(e).cumulativeOffset().top;var i=$(f);var k=i.getStyle("marginTop");if(k){k=parseInt(k.replace("px",""));}if(!k){k=0;}var j=i.cumulativeOffset().top-k;if(l>j){i.setStyle({marginTop:(l-j)+"px"});}else{i.setStyle({marginTop:0});}if(h){Event.stop(h);}};return{initialize:function(){c();if(!$(g)){return;}d=$(g).onclick;$(g).onclick=null;return null;},applyListeners:function(){if(!$(g)){return;}$(g).observe("click",c);},removeListeners:function(){if(!$(g)){return;}$(g).stopObserving("click",c);}};})());b.createUIComponent("hotelsMapWaiting",{initialize:function(){return new EzRez.UI.Spinner("hotels_map_waiting",{hide_sibling:false});}});b.createUIComponent("hotelDescriptionExpander",(function(){var c=function(){var d=function(i){var k=Event.element(i);if(k.tagName.toLowerCase()!="a"){return;}var f=Element.up(k,".supplier-desc");if(!f){return;}var j=Element.select(f,".hotel_description_inner");if(Element.hasClassName(k,"open")){Event.stop(i);var h=Element.select(f,"a.close");if(h.length>0){k.hide();h[0].show();}if(j.length>0){j[0].setStyle({height:"auto"});j[0].setStyle({overflow:"visible"});}}else{if(Element.hasClassName(k,"close")){Event.stop(i);var g=Element.select(f,"a.open");if(g.length>0){k.hide();g[0].show();}if(j.length>0){j[0].setStyle({height:""});j[0].setStyle({overflow:"hidden"});}}}};var e=$("hotel_avail_container");if(!e){e=$$(".hotel_description_outer");if(e.length>0){e=e[0];}else{e=null;}}if(e){Event.observe(e,"click",d);}this.applyListeners=function(){this.hideUnnecessaryLinks();};this.removeListeners=function(){};this.unload=function(){};this.hideUnnecessaryLinks=function(){var f=$("hotel_avail_container");if(!f){return;}var l=f.select(".hotel_description_outer");var k=f.select(".hotel_description_inner");for(var g=k.length-1;g>-1;g--){if(k[g].offsetHeight>=k[g].scrollHeight){var h=Element.select(l[g],".open");if(h.length){h[0].hide();}var j=Element.select(l[g],".close");if(j.length){j[0].hide();}}}};this.hideUnnecessaryLinks();};return{initialize:function(){return new c();}};})());b.createUIComponent("hotelResultsTabs",{initialize:function(){var c=new EzRez.UI.TabLinks({name:"HotelsTabs",default_tab:"hotels_list_view",link_active_css:"active_tab",no_hide_classname:"no_hide",onshow:function(d,e){switch(e.identify()){case"hotels_list_view":$("hotels_list_view").removeClassName("map_active");break;case"hotels_map_view":$("hotels_list_view").addClassName("map_active");if($("hotels_map_view")){$("hotels_map_view").show();}break;}}});return c;}});b.requires("hotelsMap",["hotelsMapWaiting","hotelResultsTabs","hotelMap"]);b.createUIComponent("hotelsMap",(function(){var c=function(){var h=b.use("hotelMap");var g=b.use("hotelsMapWaiting");var d=b.use("hotelResultsTabs");var f=b.getDOMController("hotelResultsController");var i=null;function e(){i=EzRez.UI.MapFactory.createMap({hotelMapData:EzRez.UI.MapHotelData.getList(),canvas_id:"hotels_map_canvas",map_options:{googleBarOptions:{suppressZoomToBounds:true}},setup:function(j){j.addControl(new GSmallMapControl());j.addControl(new GMapTypeControl());j.enableContinuousZoom();j.disableGoogleBar();},geocodeComplete:function(j,k){k.each(function(l){$("hotel_details_"+l.label).addClassName("hide_map_references");});if(0<j.length){g.hide();}}});}this.setMap=function(j){i=j;};this.getMap=function(){if(!i){e();}return i;};this.getMapCenter=function(){if(!i){e();d.showTab("hotels_map_view");}return i.getMapCenter();};this.addGeoCoord=function(l,k,j){return i.addGeoCord(l,k,j);};this.startup=function(){if(!$("hotels_map_canvas")){return false;}g.show();d.addLinks($$("#hotels_view_nav a"));if(!EzRez.UI.MapFactory.isCompatible()){$("hotels_view_nav").down("li.hotels_map_tab").hide();d.showTab("hotels_list_view");if($("hotels_list_view")){$("hotels_list_view").addClassName("gmapsDisabled");}return false;}if(h&&h.closeExtInfoWindow){h.closeExtInfoWindow();}if(EzRez.Util.Cookie.read("HotelsTabs")==="hotels_map_view"){e();}$("hotels_map_tab").observe("click",function(j){if(!i){e();}g.show();setTimeout(function(){i.fixCenter(true,function(){g.hide();});},0);});d.showLastViewedTab();if($("hotels_list_view")){this.reload($("hotels_list_view").select("div.hotel_map_container"));}return true;};this.reload=function(j){if(!EzRez.UI.MapFactory.isCompatible()||EzRez.UI.MapFactory.getMapProvider()===EzRez.UI.MapProvider.BING||!$("hotels_map_canvas")){return false;}g.show();if(!Object.isElement(j.first())){j=j.collect(function(k){return $(k);});}i.parse({elements:j,clear_markers:true,geocodeComplete:function(k,l){l.each(function(m){$("hotel_details_"+m.label).addClassName("hide_map_references");});if(k.size()>0){g.hide();}}});};this.closeExtInfoWindow=function(){if(!i||!i.getMap().closeExtInfoWindow){return;}i.getMap().closeExtInfoWindow();};this.unload=function(){d.removeLinks($$("#hotels_view_nav a"));if(i===null){return;}i.destroy();i=null;};};return{initialize:function(){var d=new c();d.startup();return d;}};})());b.createUIComponent("hotelMap",(function(){var c=function(){var f=null;var e=b.getDOMController("hotelResultsController");var d=b.use("hotelsMap");this.setMap=function(g){f=g;};this.getMap=function(){return f;};this.startup=function(){if(!EzRez.UI.MapFactory.isCompatible()){return false;}var j=$("lightbox");var l=j.select(".hotel_map_canvas");if(l.size()==0){return false;}var g=l[0].identify();if(d&&d.getMap().closeExtInfoWindow){d.getMap().closeExtInfoWindow();}var i=j.down(".gmarker .hotelObjectKey").innerHTML;var k=b.Availability.getHotel(i);var h=[{label:"1",hotel:k}];f=EzRez.UI.MapFactory.createMap({hotelMapData:h,canvas_id:g,info_id:"lightbox",setup:function(m){m.addControl(new GSmallMapControl());m.addControl(new GMapTypeControl());m.enableContinuousZoom();m.disableGoogleBar();}});};this.closeExtInfoWindow=function(){if(!f||!f.getMap().closeExtInfoWindow){return;}f.getMap().closeExtInfoWindow();};this.unload=function(){if(f===null){return;}f.destroy();f=null;};};return{initialize:function(){return new c();}};})());b.createUIComponent("lightBoxForHotelDetails",{initialize:function(){return new EzRez.UI.LightBox({className:"hotel_details",type:"iframe"});}});b.createUIComponent("lightBoxForHotelMap",{initialize:function(){return new EzRez.UI.LightBox({className:"hotel_map",type:"inline",opened:function(e,d,c){setTimeout(function(){b.use("hotelMap").startup();},500);},hidden:function(g,f,c){var e=b.use("hotelMap");e.closeExtInfoWindow();e.unload();var d=b.use("hotelsMap");d.unload();d.startup();if($("hotels_list_view")){d.reload($("hotels_list_view").select("div.hotel_map_container"));}}});}});b.createUIComponent("lightBoxForPromo",{initialize:function(){return new EzRez.UI.LightBox({className:"fhr_promo",type:"inline"});}});b.createUIComponent("lightBoxForTabbedHotelDetails",{initialize:function(){return new EzRez.UI.LightBox({className:"hotel_details_tabbed",type:"iframe"});}});b.createUIComponent("lightBoxForRoomSelectionHotelDetailsMap",{initialize:function(){return new EzRez.UI.LightBox({className:"room_selection_hotel_details_map",headerClassName:"room_selection_hotel_details_map_header",type:"iframe"});}});b.createUIComponent("lightBoxForVirtualTour",{initialize:function(){return new EzRez.UI.LightBox({className:"virtual_tour",type:"iframe"});}});b.createUIComponent("lightBoxForReviews",{initialize:function(){return new EzRez.UI.LightBox({className:"hotel_review_overlay",type:"iframe"});}});b.createUIComponent("lightBoxDefault",{initialize:function(){return new EzRez.UI.LightBox({className:"popup_overlay",type:"iframe"});}});b.requires("hotelUpdater",["hotelResultsController","hotelDescriptionExpander","bonus-offer-display","waitingDialog","hotelsMap","hotelsPerPageComponent","loyaltyPricingOptionSelectComponent"]);b.createUIComponent("hotelUpdater",(function(){var c=function(f){var i=Object.extend({create:function(){EzRez.UI.MapHotelData.clear();b.use("waitingDialog").show();b.getDOMController("hotelResultsController").removeActions();b.use("hotelDescriptionExpander").removeListeners();b.use("bonus-offer-display").removeListeners();setTimeout(function(){b.use("hotelsMap").unload();},50);},loading:function(){},complete:function(){b.getDOMController("hotelResultsController").applyActions();b.use("hotelDescriptionExpander").applyListeners();b.use("loyaltyPricingOptionSelectComponent").applyListeners();b.use("hotelDescriptionExpander").hideUnnecessaryLinks();b.use("bonus-offer-display").applyListeners();b.use("hotelsPerPageComponent").applyListeners();b.use("waitingDialog").hide();var j=b.use("hotelResultsTabs");if(!EzRez.UI.MapFactory.isCompatible()){$("hotels_view_nav").down("li.hotels_map_tab").hide();j.showTab("hotels_list_view");if($("hotels_list_view")){$("hotels_list_view").addClassName("gmapsDisabled");}}else{j.showLastViewedTab();}a.publish("hotelUpdater/succeeded");},failure:function(){b.getDOMController("hotelResultsController").applyActions();b.use("hotelDescriptionExpander").applyListeners();b.use("hotelDescriptionExpander").hideUnnecessaryLinks();b.use("bonus-offer-display").applyListeners();b.use("waitingDialog").hide();},exception:function(j,k){try{b.getDOMController("hotelResultsController").applyActions();b.use("hotelDescriptionExpander").applyListeners();b.use("hotelDescriptionExpander").hideUnnecessaryLinks();b.use("bonus-offer-display").applyListeners();b.use("waitingDialog").hide();}catch(l){}throw (k);},target:"hotel_avail_container",url:"/travel/malibu/hotel_choices_content.cfm",isLandingPage:false,params:{}},f);var g=$H();var e=i.target;var h=i.url;if(i.isLandingPage){i.params.is_landing_page=true;}function d(){var j={},k=b.use("searchFilterSettingsComponent");if(k){j=$H(k.getCurrentHotelSearchFilterSettings());j.set("fromAjax",true);j.unset("start_index");j.unset("scrollPosition");j.set("locationId",j.get("city"));j.set("locationFilterRadius",j.get("cityLocationFilterRadius"));j.set("units",j.get("units"));j.set("neighborhood_ids",j.get("neighborhoods"));j.unset("city");j.unset("startIndex");j.unset("cityFilterLocationRadius");j.unset("neighborhoods");}return j;}this.update=function(){i.create();new Ajax.Updater(e,h,{parameters:g.merge(i.params),evalScripts:true,onLoading:i.loading,onComplete:i.complete,onException:i.exception,onFailure:i.complete});document.fire("ezrez:filterTriggered",g);};this.updatePage=function(j,k){g=g.merge({start_index:j,number_per_page:k});g=g.merge({updateType:"updatePage"});this.update();};this.updateFilter=function(j){g=g.merge(d());g=g.merge(j);g=g.merge({updateType:"updateFilter"});g.unset("start_index");g.unset("scrollPosition");this.update();};this.updateSort=function(j){g=g.merge(d());g=g.merge({sort:j});g=g.merge({updateType:"updateSort"});g.unset("start_index");g.unset("scrollPosition");this.update();};this.resetParameters=function(){g=$H();};this.mergeParameters=function(j){g=g.merge(j);};this.getParameters=function(){return g;};this.isLandingPage=i.isLandingPage;};return{initialize:function(d){return new c(d);}};})());b.requires("hotelPagination",["hotelUpdater"]);b.createUIComponent("hotelPagination",(function(){var c=function(d){var j=$H({outerContainerId:"hotel_avail_container",pagerContainerClassName:"arc_pager",inactivePageClassName:"inactive",pageClassName:"page",scrollToElementSelector:".malibu_choose_hotel_header",itemsPerPage:10}).merge(d).toObject();var h=b.use("hotelUpdater");var e=$$(j.scrollToElementSelector);if(e.length>0){e=e[0];}else{e=null;}var f=$(j.outerContainerId);if(f===null){return;}Event.observe(f,"click",i);var g=parseInt(j.itemsPerPage,10);function i(n){var k=Event.element(n);if(k.tagName.toLowerCase()!="a"){return;}if(!Element.up(k,"."+j.pagerContainerClassName)){return;}if(Element.hasClassName(k,j.inactivePageClassName)){Event.stop(n);return;}if(Element.hasClassName(k,j.pageClassName)){$$(".yui-panel-container").each(function(o){o.hide();});Event.stop(n);if(e){Element.scrollTo(e);}var m=Element.readAttribute(k,"rel");var l=(m*g)-g+1;a.publish("hotelPagination/paginationClicked",[m]);h.updatePage(l,g);}}this.setItemsPerPage=function(k){g=k;};};return{initialize:function(d){return new c(d);}};})());b.createUIComponent("bonus-offer-display",(function(){var c=function(j){var k=$H({bonusParentClass:"bonusOffers",overlayContentClass:"bonusOfferText",priceContainerClass:"priceContainer",cardParentClass:"supplier-info",hotelOptionClass:"hotelOption",overlayWidth:"260",overlayYOffset:86,overlayXOffset:50}).merge(j).toObject();var d=[];var h={};var f=null;var i=function(s){if(f){f.destroy();}if(!s){return;}var o=h[s.identify()];if(!o){return;}var q=Element.up(s,".bonusOffers");if(!q){return;}var t=Element.cumulativeOffset(q);var n=Element.getHeight(q);var r=t.left+(q.getWidth()/2)+q.down().getWidth();var p=t.top-(n/2);f=new YAHOO.widget.Panel("bonusPanel",{xy:[r,p],width:k.overlayWidth+"px",visible:false,draggable:false,close:true,underlay:"none"});f.setBody(o.c);f.render(document.body);f.show();};var l=function(n){if(f){f.hide();}Event.stopObserving(document.body,"click",l);};var e=function(o){if(f){f.hide();}Event.stop(o);var n=Event.element(o);i(n);Event.observe(document.body,"click",l);};var m=function(){if(d.length>0){g();}var t=$$("."+k.bonusParentClass);if(t.length<=0){return;}for(var r=t.length-1;r>-1;r--){var o=t[r];var q=Element.select(o,"a");if(q.length==0){continue;}q=q[0];d.push(q);var p=[];var s=[];var n=Element.up(q,"."+k.cardParentClass);if(n){p=Element.select(n,"."+k.overlayContentClass);}if(p.length>0){p=p[0].innerHTML;}else{p=null;}if(n){s=Element.select(n,"."+k.priceContainerClass);}if(s.length>0){s=s[0];}else{s=null;}if(!p||!s){h[Element.identify(q)]=null;}else{h[Element.identify(q)]={c:p,cx:s};}Event.observe(q,"click",e);}};var g=function(){Event.stopObserving(document.body,"click",l);if(d.length<=0){return;}for(var n=d.length-1;n>-1;n--){Event.stopObserving(d[n],"click",e);}d=[];h={};};this.applyListeners=m;this.removeListeners=g;};return{initialize:function(d){return new c(d);},applyListeners:function(d){d.applyListeners();},removeListeners:function(d){d.removeListeners();},unload:function(d){d.removeListeners();}};})());b.createUIComponent("hotelsPerPageComponent",(function(){var c=function(){var g="#hotelsPerPage";var d=$$(g).first();if(d){var h=d.getValue();}else{var h="";}function f(i){if(i.getValue){return i.getValue();}if(i.value){return i.value;}return null;}function e(i){var k=$(i.target);var j=f(k);if(j===h){return;}b.use("hotelPagination").setItemsPerPage(j);b.use("hotelUpdater").updatePage(1,j);h=j;}this.applyListeners=function(){var i=$("hotel_avail_container");if(i){i.on("change",g,e);}};this.removeListeners=function(){};};return{initialize:function(){return new c();},applyListeners:function(d){d.applyListeners();},removeListeners:function(d){d.removeListeners();},unload:function(d){d.removeListeners();}};})());})(EzRez.Application);(function(e){if(!e){throw new EzRez.Util.Exception({message:"Missing application."});}var d=EzRez.Util.Event.pubsub;var b=function(g,j){var h=$(g.target),i=e.use(j);if(h.nodeName.strip().toLowerCase()!=="a"){h=h.up("a");}h.onclick=null;i.show(h);Event.stop(g);d.publish("hotelResultsController/lightBoxShown",[j]);return false;};var f={hotelAvailability:[],hotelResults:["lightBoxForHotelDetails","lightBoxForVirtualTour","lightBoxForHotelMap","lightBoxForTabbedHotelDetails","lightBoxDefault","lightBoxForReviews","hotelsMap","hotelMap","lightBoxForPromo"]};var a=e.createDOMController("hotelAvailabilityController",{});a.requires(f.hotelAvailability);var c=e.createDOMController("hotelResultsController",{after:function(h){if(!$("hotel_filter")||!$("hotel_results")){return;}e.load("hotelAutoComplete",{inputElement:"hotel_filter",resultsElement:"hotel_results",filterNameElement:"hotel_filter_name"});e.use("hotelAutoComplete").init();var i=$("hotel_filters");var g=$("hotel_pager_container");if(i&&g){if(i.down(".num_hotels_filtered")&&i.down(".num_hotels_unfiltered")){i.down(".num_hotels_filtered").innerHTML=g.down(".num_hotels_filtered").innerHTML;i.down(".num_hotels_unfiltered").innerHTML=g.down(".num_hotels_unfiltered").innerHTML;}}},"#hotel_avail_container div.avail_sort select,change":function(h,g){var i=$(h.target).getValue();e.use("hotelUpdater").updateSort(i);d.publish("hotelResultsController/sortingClicked",[i]);return false;},"#hotel_avail_container div.avail_sort a.sort,click":function(h,g){e.use("waitingDialog").show();var i=$(h.target);if(i.nodeName.strip().toLowerCase()!=="a"){i=i.up("a");}var j=i.href.split("#")[1];e.use("hotelUpdater").updateSort(j);Event.stop(h);return false;},"a.popup_overlay,click":function(h,g){return b(h,"lightBoxForHotelDetails");},"a.virtual_tour_overlay,click":function(h,g){return b(h,"lightBoxForVirtualTour");},"a.virtual_tour_overlay_tabbed,click":function(h,g){return b(h,"lightBoxForTabbedHotelDetails");},"a.view_more_overlay,click":function(h,g){return b(h,"lightBoxForHotelDetails");},"a.view_more_overlay_tabbed,click":function(h,g){return b(h,"lightBoxForTabbedHotelDetails");},"a.gmap_overlay,click":function(h,g){return b(h,"lightBoxForHotelMap");},"a.promo_overlay,click":function(h,g){return b(h,"lightBoxForPromo");},"a.gmap_overlay_tabbed,click":function(h,g){return b(h,"lightBoxForTabbedHotelDetails");},"a.hotel_review_overlay,click":function(h,g){return b(h,"lightBoxForReviews");},"a.hotel_review_overlay_tabbed,click":function(h,g){return b(h,"lightBoxForTabbedHotelDetails");},".card-left a.thumbnail,click":function(i,h){var g=$(i.target),k=g.up(".card-left"),j="display_tabbed_hotel_details";if(g.hasClassName(j)||k.down("."+j)){return;}return b(i,"lightBoxForHotelDetails");}});c.requires(f.hotelResults);})(EzRez.Application);(function(a){var b=function(h){var k=Object.extend({taxLinkPopupClassname:"taxLinkPopUp",taxPopupTextClassname:"taxPopupText",taxDisplayPanelId:"taxDisplayPanel"},h);var d=null;var e=false;var c=function(){d.hide();e=false;};var j=function(o){var q=o.cumulativeOffset(),p=o.getDimensions(),n=o.next("."+k.taxPopupTextClassname),m=$$(".yui-panel-container")[0];d.setBody(n.innerHTML);d.cfg.setProperty("x",q.left+p.width);d.cfg.setProperty("y",q.top+p.height);d.render(document.body);m.style.left=d.cfg.getProperty("x")+"px";m.style.top=d.cfg.getProperty("y")+"px";m.show();d.show();e=true;};var l=function(m){Event.stop(m);if(d.cfg.getProperty("visible")){c();return;}var n=m.findElement("."+k.taxLinkPopupClassname);j(n);};var g=function(m){if(Event.findElement(m,"a."+k.taxLinkPopupClassname)){l(m);}else{if(e&&!Event.findElement(m,"#"+k.taxDisplayPanelId)){c();}}};var i=function(m){Event.stop(m);c();};var f=function(){d=new YAHOO.widget.Panel(k.taxDisplayPanelId,{constraintoviewport:true,visible:false,draggable:false,monitorresize:false,iframe:true,close:false,width:"400px"});d.setHeader("<a class='container-close' href='#' alt='close' title='close'>X</a>");d.render(document.body);};this.applyListeners=function(){document.observe("click",g);$(k.taxDisplayPanelId).down("a.container-close").observe("click",i);};this.removeListeners=function(){document.stopObserving("click",g);$(k.taxDisplayPanelId).down("a.container-close").stopObserving("click",i);};f();};a.createUIComponent("taxExclusivePopUp",{initialize:function(c){return new b(c);},applyListeners:function(c){c.applyListeners();},removeListeners:function(c){c.removeListeners();},unload:function(c){c.removeListeners();}});})(EzRez.Application);(function(b){var a=function(){var c=EzRez.UI.MapFactory.isCompatible();var f=null;var k=$("hotelLandingReviews");var h=$("hotelVirtualTour");var l=$("aboutHotel");var u=$("hotelPromotion");var q=$("hotelAmenities");var g=$("roomAmenities");var w=new YAHOO.widget.TabView("hotelLandingTabbedView");w.addListener("activeTabChange",r);var t=location.href.toQueryParams();var o=$("hotelLandingMapCanvas");var i=t.map_only;if(i){o=$("hotelMapOnlyCanvas");}function r(x){var z=x.newValue;var y=z.get("contentEl");n(Element.identify(y));}function n(x){if(x==="hotelReviews"){if(o){Element.hide(o);}if(u){Element.hide(u);}if(g){Element.hide(g);}if(q){Element.hide(q);}if($("userReviews")===null){s();}else{k.show();}}else{if(x==="hotelMap"){e();if(!c){d();j();return;}Element.show(o);if(k){Element.hide(k);}if(u){Element.hide(u);}if(g){Element.hide(g);}if(q){Element.hide(q);}if(f){f.fixCenter(true);}}else{if(x==="hotelVirtualTour"){if(o){Element.hide(o);}if(k){Element.hide(k);}if(u){Element.hide(u);}if(g){Element.hide(g);}if(q){Element.hide(q);}Element.show(h);}else{if(x==="hotelPromotion"){if(q){Element.hide(q);}if(g){Element.hide(g);}if(o){Element.hide(o);}Element.show(u);}else{if(x==="hotelAmenities"){if(u){Element.hide(u);}if(g){Element.hide(g);}if(o){Element.hide(o);}if(q){Element.show(q);}}else{if(x==="roomAmenities"){if(u){Element.hide(u);}if(q){Element.hide(q);}if(o){Element.hide(o);}Element.show(g);}else{if(o){Element.hide(o);}if(k){Element.hide(k);}Element.show(l);}}}}}}}function d(){if(o){Element.hide(o);}$$("#hotelLandingTabbedView .yui-nav li.hotelMapTab").invoke("hide");}function e(){if(o){f=EzRez.UI.MapFactory.createMap({canvas_id:o.identify(),info_id:"hotelMap",default_zoom:15,setup:function(z){var y=z.getDefaultUI();y.zoom.scrollwheel=false;z.setUI(y);z.enableContinuousZoom();},geocodeComplete:function x(y,z){if(y.length===0){d();n("aboutHotel");w.selectTab(0);}}});Event.observe(document,"unload",EzRez.UI.MapFactory.unload);Event.observe(window,"unload",EzRez.UI.MapFactory.unload);}if(!c){d();}}function p(){if(top!==self){return;}var x=window.location.href.toQueryParams();if(x.show_terms_and_search==="false"){return;}$$(".hotelSearchBox, .termsAndConditions").invoke("setStyle",{display:"block"});}function j(){if(l){n("aboutHotel");}else{if(u){n("hotelPromotion");}else{n("hotelAmenities");}}}function m(){var y={hotelVirtualTour:function(){n("hotelVirtualTour");},hotelMap:function(){if(c){n("hotelMap");}else{n("aboutHotel");}},hotelReviews:function(){n("hotelReviews");},defaultTab:j};var x=y[t.view];if(x){x();}else{y.defaultTab();}}var s=function(x){var z=b.use("waitingDialog");z.show();var y=location.href.toQueryParams();y.show_partial=true;new Ajax.Updater(k,"/service/show_hotel_reviews.cfm",{parameters:y,onComplete:function(){b.load("hotelReviews");k.show();}});z.hide();};function v(){var x=t.map_only;if(x){e();Element.show(o);}else{p();m();}}v();};b.createUIComponent("hotelDetails",{initialize:function(){return new a();}});})(EzRez.Application);(function(a){EzRez.UI.HotelCardComponent=function(b){this.applyListeners=function(){if(b.shouldScrollToReviews){var c=$$(".tripAdvisorSummaryLink").first();if(c){c.observe("click",function(d){Event.stop(d);Effect.ScrollTo("userReviews");$("userReviews").focus();});}}};};a.createUIComponent("hotelCardComponent",{initialize:function(b){return new EzRez.UI.HotelCardComponent(b);},applyListeners:function(b){b.applyListeners();}});})(EzRez.Application);(function(b){var a=function(){var f=$$(".toggle a");var k=$$(".expand-reviews-section a");var h=function(o){var q={};var p=Element.up(o,".reviewOption");var r=Element.select(p,".summary");var n=Element.select(p,".full");if(r.length>0){q.summary=r[0];}if(n.length>0){q.full=n[0];}return q;};var j=function(n){var o=h(n);if(o.summary&&o.full){o.summary.hide();o.full.show();l(n,"expandTranslation","contractTranslation");d(n,"expandReview","contractReview");}};var i=function(n){var o=h(n);if(o.summary&&o.full){o.summary.show();o.full.hide();l(n,"contractTranslation","expandTranslation");d(n,"contractReview","expandReview");}};var l=function(o,q,p){var n=o.down("span."+q);var r=o.down("span."+p);n.hide();r.show();};var d=function(n,p,o){n.removeClassName(p);n.addClassName(o);};var c=function(n){if(n!=null&&n.hasClassName("expandReview")){j(n);}else{if(n!=null&&n.hasClassName("contractReview")){i(n);}}};var e=function(n){var o=Event.element(n);if(o.hasClassName("expandReview")){j(o);}else{if(o.hasClassName("contractReview")){i(o);}}};var m=function(o){Event.stop(o);var n=Event.element(o).up("a");c(n);};var g=function(q){Event.stop(q);var r=Event.element(q);var p=r.up("a");var n=r.select(".contract-translation")[0];var o=r.select(".expand-translation")[0];if(p!=null&&p.hasClassName("expandReviews")){f.each(function(s){j(s);});r.next(".contract-translation").show();p.removeClassName("expandReviews");p.addClassName("collapseReviews");r.hide();}else{if(r.hasClassName("expandReviews")){f.each(function(s){j(s);});n.show();r.removeClassName("expandReviews");r.addClassName("collapseReviews");o.hide();}else{if(p!=null&&p.hasClassName("collapseReviews")){f.each(function(s){i(s);});r.previous(".expand-translation").show();p.removeClassName("collapseReviews");p.addClassName("expandReviews");r.hide();}else{if(r.hasClassName("collapseReviews")){f.each(function(s){i(s);});o.show();r.removeClassName("collapseReviews");r.addClassName("expandReviews");n.hide();}}}}};this.applyListeners=function(){if(f.length>0){f.each(function(n){Event.observe(n,"click",m);Event.observe(n,"click",e);});}if(k.length>0){k.each(function(n){Event.observe(n,"click",g);});}};};b.createUIComponent("hotelReviews",{initialize:function(){return new a();},applyListeners:function(c){c.applyListeners();}});})(EzRez.Application);(function(a,d){function f(g){d.Util.Debug.info(g);console.info(g);}var e=function(h){var i=Object.extend({translations:{AVAILABILITY_MAP_PIN_MOVE_ME:"Move me!",AVAILABILITY_MAP_DROPPED_PIN:"Dropped Pin"}},h);function j(k){var l=i.translations[k];if(!l){return k;}return l;}function g(){var k=new GIcon();k.image="/js/gmaps/images/markers/bluePin/image.png";k.shadow="/js/gmaps/images/markers/bluePin/shadow.png";k.iconSize=new GSize(32,32);k.shadowSize=new GSize(48,32);k.iconAnchor=new GPoint(0,32);k.infoWindowAnchor=new GPoint(16,0);k.printImage="/js/gmaps/images/markers/bluePin/printImage.gif";k.mozPrintImage="/js/gmaps/images/markers/bluePin/mozPrintImage.gif";k.printShadow="/js/gmaps/images/markers/bluePin/printShadow.gif";k.transparent="/js/gmaps/images/markers/bluePin/transparent.png";k.imageMap=[18,0,20,1,23,2,24,3,26,4,26,5,26,6,26,7,24,8,22,9,22,10,22,11,21,12,21,13,20,14,21,15,21,16,22,17,22,18,22,19,22,20,22,21,22,22,21,23,19,24,13,25,13,26,12,27,12,28,12,29,11,30,11,31,9,31,9,30,9,29,9,28,9,27,10,26,10,25,10,24,11,23,9,22,8,21,7,20,6,19,5,18,5,17,5,16,5,15,6,14,7,13,8,12,11,11,11,10,11,9,12,8,12,7,12,6,13,5,12,4,11,3,11,2,11,1,12,0];return k;}this.addLocationToMap=function(o,n,m){var l={title:j("AVAILABILITY_MAP_PIN_MOVE_ME"),label:null,labelClass:"LabeledMarker_markerLabel selectedAddressLabeledMarker",marker_opts:{icon:g()}};var k=o.addGeoCord(n.lat,n.lng,l);k.enableDragging();GEvent.addListener(k,"click",function(){k.openInfoWindowHtml("<br/>"+n.address);});GEvent.addListener(k,"dragend",function(p){m(p.lat(),p.lng());});};};var b=function(g){var h=Object.extend({translations:{AVAILABILITY_MAP_PIN_MOVE_ME:"Move me!",AVAILABILITY_MAP_DROPPED_PIN:"Dropped Pin"}},g);function i(j){var k=h.translations[j];if(!k){return j;}return k;}this.addLocationToMap=function(o,l,k){var m=o.addGeoCord(l.lat,l.lng,{});var j=o.getMap();if(!j){return;}else{clearInterval(b.addLocationToMapInterval);}m.setOptions({draggable:true,icon:"/js/gmaps/images/markers/bluePin/image.png",width:32,height:32,zIndex:1002});var n=new Microsoft.Maps.Infobox(m.getLocation(),{showPointer:true,showCloseButton:false,visible:false,zIndex:100,width:150,height:40,offset:new Microsoft.Maps.Point(0,30),description:i("AVAILABILITY_MAP_PIN_MOVE_ME")});j.entities.push(n);Microsoft.Maps.Events.addHandler(m,"mouseover",function(){document.body.style.cursor="move";n.setOptions({visible:true});});Microsoft.Maps.Events.addHandler(m,"mouseout",function(){document.body.style.cursor="default";n.setOptions({visible:false});});Microsoft.Maps.Events.addHandler(m,"dragstart",function(p){n.setOptions({visible:false});});Microsoft.Maps.Events.addHandler(m,"dragend",function(q){var p=q.location;k(p.latitude,p.longitude);});};};b.addLocationToMapInterval=null;var c=function(r){var s=Object.extend({translations:{AVAILABILITY_MAP_PIN_MOVE_ME:"Move me!",AVAILABILITY_MAP_DROPPED_PIN:"Dropped Pin"}},r);var y=".mapAddressSearchContainer";var h="mapAddressSearchActiveContainer";var t=function(M){};var g=new d.UI.DOMCache({rootNode:y,nodes:{addressInput:function(M){return M.down("input.nearbyAddress");},addressResultsUl:function(M){return M.down("ul.addressResults");},addressResultsContainer:function(M){return M.down("div.addressResultsContainer");},noAddressResultsContainer:function(M){return M.down("div.noAddressResultsContainer");},selectedAddressContainer:function(M){return M.down("div.selectedAddressContainer");},selectedAddress:function(M){return M.down("div.selectedAddressContainer span.selectedAddress");},errorMessage:function(M){return M.down("div.errorMessage");}}});var A=d.UI.MapFactory.isCompatible();var D=$H();var H=null;var k=null;var x=false;function w(M){var N=s.translations[M];if(!N){return M;}return N;}function o(){g.addressResultsContainer.hide();g.noAddressResultsContainer.hide();g.selectedAddressContainer.hide();g.errorMessage.hide();}function K(M){g.noAddressResultsContainer.show();}function E(M){var O=a.use("hotelsMap");var N;if(d.Connector.GeocoderFactory.getType()===d.Connector.GeocoderType.GOOGLE){N=new e(s);N.addLocationToMap(O.getMap(),M,u);}else{N=new b(s);if(b.addLocationToMapInterval){clearInterval(b.addLocationToMapInterval);}b.addLocationToMapInterval=setInterval(function(){console.log("running addLocationToMapInterval interval");var P=O.getMap();if(P){N.addLocationToMap(O.getMap(),M,u);}},200);}}function L(M){D=$H();g.addressResultsUl.update("");M.each(function(O){var N=d.StringUtil.isSet(O.formattedAddress)?O.formattedAddress:O.address.toString();D.set(N.toLowerCase(),O);g.addressResultsUl.insert('<li class="addressResults"><a href="#">#{address}</a></li>'.interpolate({address:N}));});g.addressResultsContainer.show();x=true;}function G(M){a.Search.cityMapGeoLocation=M;if(g.rootNode){g.rootNode.removeClassName(h);}l();o();E(M);var N=a.use("hotelMiniMap");if(N){N.createStaticMap(M);}f("  Sorting by distance from: "+M.address);console.dir(M);H=M;var O={lat:M.lat,lng:M.lng,address:M.formattedAddress,sort:"hotel_distance_from_geocords"};t(O);x=false;}function q(P,O,N){f(" Dropped pin: using pin geo coordinates");var M=new d.WebApi.GeoLocation({lat:P,lng:O,formattedAddress:N});G(M);}function l(){var N=a.use("hotelResultsTabs");var O=a.use("hotelsMapWaiting");var M=a.use("hotelsMap").getMap();O.show();N.showTab("hotels_map_view");setTimeout(function(){M.fixCenter(true,function(){O.hide();});},0);}function n(M){o();H=null;k.getLocations(M,function(N){f("Geocoding address: "+M+".");if(N.length===0){K(M);return;}console.dir(N);var O=a.use("hotelsMap");var Q=O.getMapCenter();var P=N.findAll(function(R){var U=Math.abs(Q.lat-R.lat);var T=Math.abs(Q.lng-R.lng);var S=U<=2&&T<=2;if(!S){f("  Inaccurate location: "+R.address);}return S;});if(P.length===0){f("  No accurate locations");f("  Failed to geocode address.");K(M);return;}if(P.length===1){G(P.first());return;}L(P);});}function u(N,M){H=null;k.getAddress(N,M,function(O){f("Reverse Geocoding coordinate: "+N+", "+M+".");if(O.length===0){q(N,M,w("AVAILABILITY_MAP_DROPPED_PIN"));return;}console.dir(O);if(O.length===0){f("  No accurate locations");f("  Failed to reverse geocode coordinate.");q(N,M,w("AVAILABILITY_MAP_DROPPED_PIN"));return;}var P=O.first();f("  Reverse geocode success: "+P.address);G(P);});}function i(M){$(M.target).value="";}function C(M){if(M.keyCode!==Event.KEY_RETURN){return;}g.setRootNode($(M.target).up(y));n(g.addressInput.getValue());}function B(M){g.setRootNode($(M.target).up(y));n(g.addressInput.getValue());}function m(N){Event.stop(N);var O=N.findElement("li.addressResults a");var M=D.get(O.innerHTML.toLowerCase());g.setRootNode(O.up(y));G(M);}function v(M){var N=Event.findElement(M,y);if(!N){return;}g.setRootNode(N);g.rootNode.addClassName(h);}function j(M){var N=Event.findElement(M,y);if(!N||x){return;}g.setRootNode(N);g.rootNode.removeClassName(h);}function J(M){var N=Event.findElement(M,y);if(N){return;}$$(y).each(function(O){if(O.hasClassName(h)){g.setRootNode(O);g.rootNode.removeClassName(h);}});}var z=[];function p(){if(!A){return;}$$(y).each(function(M){z.push(M.on("mouseover",v));z.push(M.on("mouseout",j));});$$(y+" input.nearbyAddress").each(function(M){z.push(M.on("focus",i));z.push(M.on("keydown",C));});z.push($(document.body).on("click",y+" input.submitNearbyAddress",B));z.push($(document.body).on("click",y+" ul.addressResults",m));z.push($(document.body).on("click",J));}function F(){z.invoke("stop");z=[];}function I(){if(!A){return;}if(!k){k=d.Connector.GeocoderFactory.create();}}this.applyListeners=p;this.removeListeners=F;this.reinitialize=function(N){if(!A){return;}I();F();p();if(H){var M=$$(N).first();g.setRootNode(M);E(H);}};this.clearSelectedLocation=function(){H=null;};this.setUpdateCallback=function(M){t=M;};I();};a.createUIComponent("hotelMapDistanceSorter",{initialize:function(g){return new c(g);},applyListeners:function(g){g.applyListeners();},removeListeners:function(g){g.removeListeners();}});})(EzRez.Application,EzRez);(function(b){var c=function(f){var h=Object.extend({bindElement:null,html:""},f);var d;var g=[];function i(){d=new YAHOO.widget.Overlay("packageSavingsDetailsOverlay",{context:[h.bindElement,"tr","br",["beforeShow","windowResize"]],visible:true,iframe:true,width:"275px",effect:{effect:YAHOO.widget.ContainerEffect.FADE,duration:0.25}});d.setBody(h.html);d.render(document.body);g.push($(d.element).on("click","a.packageSavingsDetailsCloseButton",function(j){Event.stop(j);e();}));}function e(j){if(!d){if(j){j();}return;}d.hide();g.invoke("stop");setTimeout(function(){d.destroy();d=null;if(j){j();}},300);}this.destroy=e;i();};var a=function(e){var g=Object.extend({ajaxUrl:"/service/availability/"},e);var d;function h(j,i){d=new c({bindElement:j,html:i});}function f(i){Event.stop(i);var k=Event.findElement(i,".packageSavingsDetailsButton");if(!k){return;}var j=k.up(".priceContainer");var l=k.href.toQueryParams();new Ajax.Request(g.ajaxUrl,{method:"post",parameters:l,onSuccess:function(n){var m=new EzRez.WebApi.FormProcessorHtmlResponse(n.responseText.evalJSON());if(m.success){if(d){d.destroy(function(){h(j,m.html);});}else{h(j,m.html);}}}});}this.applyListeners=function(){document.on("click","a.packageSavingsDetailsButton",f);};};b.createUIComponent("packageSavingsPriceDetailsComponent",{initialize:function(){return new a();},applyListeners:function(d){d.applyListeners();}});b.load("packageSavingsPriceDetailsComponent");})(EzRez.Application);(function(c){var a=EzRez.Util.Event.pubsub;var b=function(j){var k=Object.extend({cityGeoLocations:[],priceSliderTicks:[],ratingSliderTicks:[],defaultPriceMinVal:null,defaultPriceMaxVal:null,defaultRatingMinVal:null,defaultRatingMaxVal:null,initSearchLocationJson:{}},j);var H=false;var o=false;var A=$H();var G=c.use("hotelUpdater");var g=c.use("waitingDialog");var r=c.use("hotelMapDistanceSorter");var v="activeHotelFilterContainer";var i="activeLabeledInput";function h(J){var I=J.select(".checkboxOptionsContainer .optionGroup").size();return[v,v+"_"+I];}function t(I){h(I).each(function(J){I.removeClassName(J);});}function p(I){h(I).each(function(J){I.addClassName(J);});}function D(){$$("#hotel_filters .hotelFilterContainer").each(function(I){t(I);});}function q(I){if(I){I.select(".optionGroup .labeledInput input").each(function(J){if(!J.checked){J.up(".labeledInput").removeClassName(i);}});}}function y(I,J){if(H){return;}G.updateFilter({price_min:I.value,price_max:J.value});a.publish("HotelFilters/filterChanged",["price"]);}function z(I,J){if(o){return;}G.updateFilter({rating_min:I.value,rating_max:J.value});a.publish("HotelFilters/filterChanged",["rating"]);}function l(){var I=A.get("neighborhoodFilter");if(I){I.reset();G.getParameters().unset("neighborhood_ids");G.getParameters().unset("filterFromAllResults");q($("neighborhood_filter_form"));}}function d(){var I=A.get("cityFilter");if(I){I.reset();var J=G.getParameters();J.unset("locationJson");J.unset("locationFilterRadius");J.unset("units");J.unset("locationId");q($("city_filter_form"));}}function s(I,J){d();n(I,J);a.publish("HotelFilters/filterChanged",["neighborHood"]);}function n(J,K){g.show();var I=$H();I.set(K,J);if(K==="neighborhood_ids"){I.set("filterFromAllResults",true);}I.set("fromAjax",true);f(k.initSearchLocationJson);q($("neighborhood_filter_form"));G.updateFilter(I.toObject());}function x(K){g.show();var J=K.locationJson;var I=J?J.evalJSON():k.initSearchLocationJson;f(I);q($("city_filter_form"));l();D();G.updateFilter(K);a.publish("HotelFilters/filterChanged",["city"]);}function f(I){var K=c.use("hotelMiniMap");if(K){K.createStaticMap(I);}if(r){r.clearSelectedLocation();}var L=$$("input.nearbyAddress").first();if(L){L.setValue("");c.Search.cityMapGeoLocation=null;}var J=G.getParameters();J.unset("lat");J.unset("lng");J.unset("address");}function F(L){g.show();var I=A.get("cityFilter");if(I){I.reset();}var K=A.get("neighborhoodFilter");if(K){K.reset();}var J=G.getParameters();J.unset("start_index");J.unset("locationJson");J.unset("distance");J.unset("neighborhood_ids");J.unset("filterFromAllResults");G.updateFilter(L);}function C(){g.show();var I=$H();H=true;o=true;A.each(function(K){var J=K.value;J.reset();if(J.getCheckboxName){I.set(J.getCheckboxName(),J.getCheckedValues());}});I.set("filterFromAllResults",true);I.set("fromAjax",true);I.set("resetAllFilters",true);H=false;o=false;G.resetParameters();G.updateFilter(I.toObject());}function m(){if($("hotelFilterPriceContainer")){A.set("priceFilter",new EzRez.UI.DualSliderFilter({id:"hotelFilterPriceContainer",ticks:k.priceSliderTicks,defaultMinVal:k.defaultPriceMinVal,defaultMaxVal:k.defaultPriceMaxVal,update:y}));}if($("hotelFilterRatingContainer")){A.set("ratingFilter",new EzRez.UI.DualSliderFilter({id:"hotelFilterRatingContainer",ticks:k.ratingSliderTicks,defaultMinVal:k.defaultRatingMinVal,defaultMaxVal:k.defaultRatingMaxVal,update:z}));}if(r){r.setUpdateCallback(F);}if($("city_filter_form")){A.set("cityFilter",new EzRez.UI.DistanceFilter({formSelector:"#city_filter_form",geoLocations:k.cityGeoLocations,update:x}));}if($("neighborhood_filter_form")){A.set("neighborhoodFilter",new EzRez.UI.CheckboxFilter({form_id:"neighborhood_filter_form",checkbox_name:"neighborhood_ids",checked_by_default:false,show_all_id:"neighborhood_filter_show_all",update:s}));}if($("amenities_filter_form")){A.set("amenityFilter",new EzRez.UI.IconFilter({form_id:"amenities_filter_form",checkbox_name:"amenities",active_classname:"active_amenity",hover_classname:"li_hover",checked_by_default:false,update:n}));}}function E(I){C();Event.stop(I);}function B(J){var K=$(J.target);var L=K.up(".activeHotelFilterContainer");var I=K.hasClassName("filterViewLess");if(L&&K.type!=="checkbox"&&!I){return;}$$("."+v).each(function(M){t(M);});}function e(J){Event.stop(J);var I=$(J.target).up(".hotelFilterContainer");p(I);}function w(J){var I=$(J.target);I.up(".optionGroup").up(".labeledInput").select("input").each(function(K){var L=K.up(".labeledInput");if(K.checked){L.addClassName(i);}else{L.removeClassName(i);}});}function u(){var I=c.use("searchFilterSettingsComponent");if(I){I.executeSavedHotelSearchFilters();}}this.applyListeners=function(){A.each(function(J){J.value.applyListeners();});var I=$("hotel_filters");$("hotel_filters_reset_all_filters").observe("click",E);I.on("click",".filterViewMore",e);I.on("click",".optionGroup input",w);$(document.body).on("click",B);};this.removeListeners=function(){A.each(function(I){I.value.removeListeners();});$("hotel_filters_reset_all_filters").stopObserving("click",E);};m();u();};c.requires("hotelFilters",["alignHotelFilters","hotelUpdater"]);c.createUIComponent("hotelFilters",{initialize:function(d){return new b(d);},applyListeners:function(d){d.applyListeners();},removeListeners:function(d){d.removeListeners();},unload:function(d){d.removeListeners();}});})(EzRez.Application);(function(b){var a=function(g){var j=Object.extend({searchLocation:new EzRez.WebApi.GeoLocation(),isRoomSelection:false,isLandingPage:false},g);var l;var h;var k;function f(){var n=$$(".hotelMiniMap").first();var m={hotelMiniMapImages:function(){return n.down(".hotelMiniMapImages");},hotelMiniMapImageLink:function(){return n.down(".hotelMiniMapImageLink");}};if(!j.isRoomSelection&&!j.isLandingPage){m.searchLocationName=function(){return n.down(".hotelMiniMapLocation .searchLocationName");};m.hotelMiniMapLink=function(){return n.down(".hotelMiniMapLink");};}l={rootNode:n,nodes:m};}function d(m){Event.stop(m);if(j.isRoomSelection||j.isLandingPage){var n=$(m.target);if(n.nodeName.strip().toLowerCase()!=="a"){n=n.up("a");}n.onclick=null;b.use("lightBoxForRoomSelectionHotelDetailsMap").show(n);}else{var o=b.use("hotelResultsTabs");k=b.use("hotelsMapWaiting");k.show();o.showTab("hotels_map_view");e();}}function e(){h=setInterval(function(){var m=b.use("hotelsMap").getMap();if(!m){return;}clearInterval(h);m.fixCenter(true,function(){k.hide();});},200);}function c(n){if(!n){return;}var m=l.nodes.hotelMiniMapImageLink().getDimensions();if(m.width>0&&m.height>0){var o=EzRez.UI.MapFactory.createStaticMap({width:m.width,height:m.height,center:n,zoom:11});l.nodes.hotelMiniMapImageLink().update(o.createImage());}if(!j.isRoomSelection&&!j.isLandingPage&&l.nodes.searchLocationName()){l.nodes.searchLocationName().update(n.formattedAddress);}}function i(){f();c(j.searchLocation);}this.createStaticMap=c;this.applyListeners=function(){l.rootNode.on("click",".hotelMiniMapImages,.hotelMiniMapLink",d);};i();};b.createUIComponent("hotelMiniMap",{initialize:function(c){return new a(c);},applyListeners:function(c){c.applyListeners();}});})(EzRez.Application);(function(b){var a=function(c){var g="#hotelsPerPage",f=$$(g).first(),h=(f&&f.length)?f.getValue():null;function e(i){if(i.getValue){return i.getValue();}if(i.value){return i.value;}return null;}function d(i){var k=$(i.target);var j=e(k);if(j===h){return;}b.use("hotelPagination").setItemsPerPage(j);b.use("hotelUpdater").updatePage(1,j);h=j;}this.applyListeners=function(){$("hotel_avail_container").on("change",g,d);};};b.createUIComponent("hotelsPerPageComponent",{initialize:function(c){return new a(c);},applyListeners:function(c){c.applyListeners();},removeListeners:function(c){c.removeListeners();},unload:function(c){c.removeListeners();}});})(EzRez.Application);var EzRez=EzRez||{};EzRez.UI=EzRez.UI||{};EzRez.Application=EzRez.Application||{};(function(a){EzRez.UI.SearchFilterSettingsComponent=function(g,i,e){if(!i||!e){return;}var h=Object.extend({sortBy:null,lastScrollPosition:0,selectedHotelIndex:-1,showRoomTypeOptions:"Show rooms",hideRoomTypeOptions:"Hide rooms"},g);var d=this;var l=null;var b=null;var j=null;var k=null;var r=null;var u=null;var o=null;var m=null;var p="SEARCH_FILTER_SETTINGS";var c=["hotel_composite_score","connector_pref","hotel_name","hotel_price_ascending","hotel_price_descending","package_savings_price_descending","package_savings_percent_descending","hotel_min_room_strikethrough_price","hotel_rating","hotel_choice_model"];function q(){l=e("hotel_filters");b=e("avail_sort_select");if(l){j=l.down(".mapAddressSearchContainer");k=l.down("#hotelFilterPriceContainer");r=l.down("#hotelFilterRatingContainer");u=l.down(".city_filter");o=l.down(".amenities_filter");m=l.down(".neighborhood_filter");}}function t(v){return v.replace("px","");}function f(){if(u){var v=u.down("input[name=locationId]:checked");if(v){v.up(".radioLabeledInput").addClassName("activeLabeledInput");}}}function s(){if(h.lastScrollPosition>0){window.scrollTo(0,h.lastScrollPosition);}}function n(){var w=h.selectedHotelIndex,v=i("input[name=hotel_index][value="+w+"]").first();if(w>-1&&v){v.up(".supplier_detail").next().down(".show-hide-button").innerHTML=h.hideRoomTypeOptions;v.up(".hotel-card-component").next().show();}}this.saveHotelSearchFilterSettings=function(v){EzRez.Util.Cookie.create(p,JSON.stringify(this.getCurrentHotelSearchFilterSettings(v)));};this.getCurrentHotelSearchFilterSettings=function(w){q();var J={};var v=i("input[name=hotel_index]").first();if(v){J.startIndex=parseInt(v.value,10)||1;}if(b){var B=b.value;J.sortBy=c.include(B)?B:null;}if(l){if(j){J.findHotelsNearbyMapGeoLocation=a.Search.cityMapGeoLocation;var D=j.down("[name=defaultFindHotelByAddressText]").value;var G=j.down("input.nearbyAddress").value;J.findHotelsNearby=(D!==G)?G:"";}if(k){J.priceRangeMinimum=parseFloat(k.down("input.min").value);J.priceRangeMaximum=parseFloat(k.down("input.max").value);J.priceRangeMinimumPosition=Math.ceil(t(k.down(".thumbMin").getStyle("left")));J.priceRangeMaximumPosition=Math.ceil(t(k.down(".thumbMax").getStyle("left")));}if(r){J.starRatingMinimum=parseFloat(r.down("input.min").value);J.starRatingMaximum=parseFloat(r.down("input.max").value);J.starRatingMinimumPosition=Math.ceil(t(r.down(".thumbMin").getStyle("left")));J.starRatingMaximumPosition=Math.ceil(t(r.down(".thumbMax").getStyle("left")));}if(u){var E=u.down("input[name=locationId]:checked");var z=a.Search.cityFilterGeoLocations;if(E&&z){var F=E.value;var A=z[F];if(A){J.latitude=A.lat;J.longitude=A.lng;J.city=F;}}J.cityLocationFilterRadius=parseFloat(u.down("select[name=locationFilterRadius]").value);var I=u.down("input[name=toggleUnits]:checked");if(I){J.units=I.value;}}if(o){var y=o.select("input[name=amenities]:checked");if(y.length){J.amenities=y.collect(function(K){return K.value;});}}if(m){var x=m.select("input[name=neighborhood_ids]:checked");if(x.length){J.neighborhoods=x.collect(function(K){return K.value;});}}var H=document.documentElement;var C=document.body;J.scrollPosition=parseFloat(H&&H.scrollTop||C&&C.scrollTop||0);}if(w){J.selectedHotelIndex=parseInt(d.findHotelIndex(w));}return J;};this.removeHotelSearchFilterSettings=function(){EzRez.Util.Cookie.erase(p);};this.findHotelIndex=function(w){var v=w.up(".drawer");if(w.className=="choose-and-continue"){return w.up(".hotel-card-component").down("[name='hotel_index']").value;}else{if(v){return v.previous().down("[name='hotel_index']").value;}}};this.applyListeners=function(){e(document.body).on("click","a.choose-and-continue",function(v){d.saveHotelSearchFilterSettings(v.target);});};this.executeSavedHotelSearchFilters=function(){f();s();var v=i(".drawer");if(v.length>0){n();}};q();};a.createUIComponent("searchFilterSettingsComponent",{initialize:function(b){return new EzRez.UI.SearchFilterSettingsComponent(b,$$,$);},applyListeners:function(b){b.applyListeners();}});})(EzRez.Application);(function(b){var a=function(k){var l=Object.extend({choiceListKey:"",translations:{openRoomDetails:"See more",closeRoomDetails:"See less",showRoomTypeOptions:"Show rooms",hideRoomTypeOptions:"Hide rooms"}},k);var i=this;var u=$$(".room-selection-hotel-details-room-component");var j=$$(".show-details-link").length>0;var f=b.use("waitingDialog");function r(){w($$(".to-truncate-room-description"),l.roomDescriptionCharLimit);}function w(B,A){if(B){B.each(function(C){C.innerHTML=EzRez.StringUtil.truncate(C.innerHTML,A);});}}function n(A,B){var C=[parseInt(A.pageX,10)+10,parseInt(A.pageY,10)+10];_toolTip.setBody(A.target.up("."+B).down(".tooltip-details").innerHTML);_toolTip.cfg.setProperty("xy",C);_toolTip.show();}function p(){_toolTip.hide();}function y(A){n(A,"on-request-tooltip");}function s(N){if("&lt;\n&gt;".unescapeHTML()!=="<\n>"){String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");};}var Q=N.down(".room-types-fieldset").getElementsByClassName("tab-room-info");for(var L=0;L<Q.length;L++){var B=Q[L];var F=B.down(".room-name");var P=B.down(".room-type-details-container");var O=B.down(".promotions");var H=false;var E=false;var C=false;if(F){var R=F.getHeight();z(F);var G=F.getHeight();H=R>G;}if(P&&EzRez.StringUtil.trim(P.innerHTML.unescapeHTML()).length>0){P.addClassName("isCollapsable");var A=P.getHeight();c(P);var D=P.getHeight();E=A>D;}if(P){var J=P.next(".show-details-link");if(J&&(H||E)){J.setStyle({display:"block"});}}if(O){var M=O.down(".value").getHeight();v(O);var K=O.down(".value").getHeight();C=M!==K;var I=O.down(".show-details-link");if(I&&C){I.setStyle({display:"block"});}}if(L>4){B.addClassName("hide-room");}}}function z(A){A.addClassName("include-truncation");}function h(A){A.removeClassName("include-truncation");}function c(A){A.addClassName("include-truncation");var B=A.down(".full-description");if(B){B.addClassName("include-truncation");}}function q(A){A.removeClassName("include-truncation");var B=A.down(".full-description");if(B){B.removeClassName("include-truncation");}}function v(A){A.down(".value").addClassName("include-truncation");A.down("li").addClassName("include-truncation");}function x(A){A.down(".value").removeClassName("include-truncation");A.down("li").removeClassName("include-truncation");}function g(B){var D=$(B.target);var A=D.up(".tab-room-info");var F=A.select(".show-details-link a");var E=A.down(".room-name");var C=A.down(".room-type-details-container");var G=A.down(".promotions");if(A.hasClassName("details-expanded")){A.removeClassName("details-expanded");if(E){z(E);}if(C&&C.hasClassName("isCollapsable")){c(C);}if(G){v(G);}F.each(function(H){e(H,l.translations.openRoomDetails);});}else{if(E){h(E);}if(C&&C.hasClassName("isCollapsable")){q(C);}if(G){x(G);}A.addClassName("details-expanded");F.each(function(H){e(H,l.translations.closeRoomDetails);});}Event.stop(B);}function e(A,B){A.innerHTML=B;}function t(A){return A.offsetWidth>0&&A.offsetHeight>0;}this.showAllRoomSegmentsForThisRoomOccupancy=function(B){var A=$(B.target),C=A.up(".room-types-fieldset"),F=A.up(".js-show-additional-rooms"),G=C&&C.select(".tab-room-info").findAll(function(H){return !t(H);}),E=F?10:5,D;if(G.size()>0){D=G.splice(0,E);D.invoke("addClassName","show-room");D.invoke("removeClassName","hide-room");if(!F||G.size()<1){C.addClassName("show-all-room-types");}}};function d(B){Event.stop(B);var A=$(B.target),C=A.up(".room-types-fieldset"),D=C.select(".show-room");C.removeClassName("show-all-room-types");D.invoke("addClassName","hide-room");D.invoke("removeClassName","show-room");}function m(){var F=$$(".room-types-fieldset");for(var B=0;B<F.length;B++){var G=0;var E=parseInt(F[B].down(".room-count-hidden").value,10);var D=F[B].getElementsByClassName("tab-room-info");for(var A=0;A<D.length;A++){if(D[A].getStyle("display")==="block"){G++;}}if(E===G){var C=F[B].down(".change-room-selection");if(C){C.hide();}}}}this.applyListeners=function(){for(var A=0;A<u.length;A++){u[A].on("click",".show-details-link a",g);u[A].on("click",".change-room-selection-open",i.showAllRoomSegmentsForThisRoomOccupancy);u[A].on("click",".change-room-selection-close",d);}var B=$(document.body);B.on("click","a.show-hide-button",function(C){var E=C.target;var D=E.up(".hotel-card-component");var F;if(D){drawer=D.next();F=drawer.style.display==="none";if(F){E.innerHTML=l.translations.hideRoomTypeOptions;}else{E.innerHTML=l.translations.showRoomTypeOptions;}}else{drawer=E.up(".drawer");F=drawer.style.display==="none";$$(".supplier-info .show-hide-button").each(function(G){G.innerHTML=l.translations.showRoomTypeOptions;});}if(F){drawer.show();if(j){s(drawer);}}else{drawer.hide();}Event.stop(C);});B.on("click","a.checkoutButton",function(C){var D=C.target;var E=b.use("searchFilterSettingsComponent");i.updateRoomKey(D);i.submitFormToSetRoomSelection(D);f.show();if(E){E.saveHotelSearchFilterSettings(D);}Event.stop(C);});};this.updateRoomKey=function(A){A.up(".room-types-form").previous().down(".select-room-segment-key").value=A.up(".tab-room-info").down(".room-segment-object-key").value;};function o(){var A=b.use("searchFilterSettingsComponent");if(A){A.removeHotelSearchFilterSettings();}}this.submitFormToSetRoomSelection=function(C){var D=C.up(".room-types-form").previous();var E=$$('form[name="arc_availability"]').first();if(E){o();E.submit();}else{if(D){var B=C.up(".room-types-form").previous().down(".select-room-segment-key").value;var A=C.up(".room-types-form").previous().down(".select-hotel-key").value;o();D.action="/travel/arc_process.cfm?hotelKey="+A+"&roomKey="+B+"&choiceListKey="+l.choiceListKey+"&recalc_upsell_room_package=false";D.submit();}}};this.initialize=function(){if(j){m();}};};b.createUIComponent("hotelSearchResultsRoomSelectionComponent",{initialize:function(d){var c=new a(d);c.initialize();return c;},applyListeners:function(c){c.applyListeners();}});})(EzRez.Application);